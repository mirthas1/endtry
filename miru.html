<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fine Total — Itemized Calculator</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --muted:#6b7280;
      --accent:#0ea5a4; --danger:#ef4444; --glass:rgba(255,255,255,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; background:
      linear-gradient(180deg, #eef2f7 0%, var(--bg) 100%);
      display:flex; align-items:center; justify-content:center; padding:28px;
      color:#0f172a;
    }
    .wrap{
      width:100%; max-width:980px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom:18px;
    }
    h1{margin:0;font-size:1.25rem}
    p.lead{margin:0;color:var(--muted);font-size:.95rem}
    .grid{
      display:grid; grid-template-columns: 1fr 340px; gap:18px;
    }
    .card{
      background:var(--card); border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(14,20,30,0.06);
    }
    .items{display:flex;flex-direction:column; gap:12px}
    .item-row{display:flex; gap:8px; align-items:center}
    .item-row input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid #e6edf3}
    .item-row input[type="number"]{width:110px;padding:10px;border-radius:8px;border:1px solid #e6edf3}
    .controls{display:flex; gap:8px; align-items:center}
    button.btn{
      padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
      background:linear-gradient(180deg,var(--accent),#0b9c9a); color:white;
      box-shadow:0 6px 12px rgba(14,165,164,0.12);
    }
    button.ghost{background:transparent;border:1px solid #e6edf3;color:var(--muted);font-weight:600}
    .small{font-size:.85rem;color:var(--muted)}
    .summary{display:flex;flex-direction:column; gap:12px}
    .summary-row{display:flex;justify-content:space-between;align-items:center}
    .summary-row.total{font-weight:800;font-size:1.1rem}
    .muted{color:var(--muted)}
    .actions{display:flex; gap:8px; justify-content:flex-end}
    .remove{background:transparent;border:none;color:var(--danger);cursor:pointer;font-weight:700}
    @media (max-width:880px){
      .grid{grid-template-columns: 1fr; }
      .item-row input[type="number"]{width:90px}
      .wrap{padding:0 6px}
    }
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <header>
      <div>
        <h1>Fine Total — Itemized Calculator</h1>
        <p class="lead">Add items, set tax/discounts and see subtotal and grand total instantly.</p>
      </div>
      <div class="small muted">Tip: add items and press <strong>Add item</strong>.</div>
    </header>

    <section class="grid" aria-labelledby="calculator-heading">
      <div class="card" id="left">
        <h2 id="calculator-heading" style="font-size:1rem;margin:0 0 12px 0">Items</h2>

        <div class="items" id="itemsList" aria-live="polite">
          <!-- rows injected here -->
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
          <button class="btn" id="addItemBtn" type="button">+ Add item</button>
          <button class="ghost" id="clearBtn" type="button">Clear all</button>
        </div>

        <div style="margin-top:14px;" class="small muted">
          You can use decimals in price and quantity. Quantity accepts fractional numbers (e.g., weight).
        </div>
      </div>

      <aside class="card" id="right">
        <h2 style="font-size:1rem;margin:0 0 12px 0">Summary</h2>

        <div class="summary">
          <div class="summary-row">
            <span class="muted">Subtotal</span>
            <span id="subtotal">0.00</span>
          </div>

          <div class="summary-row">
            <label for="taxRate" class="muted">Tax (%)</label>
            <div class="controls">
              <input id="taxRate" type="number" min="0" step="0.01" value="0" style="width:110px;padding:8px;border-radius:8px;border:1px solid #e6edf3" />
            </div>
          </div>

          <div class="summary-row">
            <label for="discount" class="muted">Discount (fixed)</label>
            <div class="controls">
              <input id="discount" type="number" min="0" step="0.01" value="0" style="width:110px;padding:8px;border-radius:8px;border:1px solid #e6edf3" />
            </div>
          </div>

          <div class="summary-row">
            <span class="muted">Tax amount</span>
            <span id="taxAmount">0.00</span>
          </div>

          <div class="summary-row total">
            <span>Grand total</span>
            <span id="grandTotal">0.00</span>
          </div>

          <div style="display:flex;gap:8px; margin-top:6px;">
            <button class="btn" id="exportCsv">Export CSV</button>
            <button class="ghost" id="resetBtn">Reset</button>
          </div>

          <div class="small muted" style="margin-top:8px">
            Currency: <strong>Decimal numbers</strong>. All calculations use simple arithmetic and round to 2 decimal places for display.
          </div>
        </div>
      </aside>
    </section>
  </main>

  <template id="item-template">
    <div class="item-row card" style="padding:10px;display:flex;align-items:center;">
      <input type="text" class="item-name" placeholder="Item name (e.g., Pen)" aria-label="Item name"/>
      <input type="number" class="item-qty" min="0" step="0.01" value="1" aria-label="Quantity"/>
      <input type="number" class="item-price" min="0" step="0.01" value="0.00" aria-label="Price per unit"/>
      <div style="display:flex;gap:6px;align-items:center">
        <button class="ghost remove-item" title="Remove item" aria-label="Remove item">✕</button>
      </div>
    </div>
  </template>

  <script>
    // Utility: round to 2 decimals for display
    const fmt = v => Number(v || 0).toFixed(2);

    // DOM refs
    const itemsList = document.getElementById('itemsList');
    const addItemBtn = document.getElementById('addItemBtn');
    const subtotalEl = document.getElementById('subtotal');
    const taxRateEl = document.getElementById('taxRate');
    const discountEl = document.getElementById('discount');
    const taxAmountEl = document.getElementById('taxAmount');
    const grandTotalEl = document.getElementById('grandTotal');
    const clearBtn = document.getElementById('clearBtn');
    const resetBtn = document.getElementById('resetBtn');
    const exportCsvBtn = document.getElementById('exportCsv');
    const itemTemplate = document.getElementById('item-template');

    // Add a new item row
    function addItem(data = {name:'', qty:1, price:0}){
      const node = itemTemplate.content.firstElementChild.cloneNode(true);
      const name = node.querySelector('.item-name');
      const qty  = node.querySelector('.item-qty');
      const price= node.querySelector('.item-price');
      const removeBtn = node.querySelector('.remove-item');

      name.value = data.name || '';
      qty.value = data.qty ?? 1;
      price.value = (data.price ?? 0).toFixed ? (data.price).toFixed(2) : data.price;

      // listeners
      [name, qty, price].forEach(el => el.addEventListener('input', calculate));
      removeBtn.addEventListener('click', () => { node.remove(); calculate(); });

      itemsList.appendChild(node);
      // focus name for fast input
      name.focus();
      calculate();
    }

    // Compute totals
    function calculate(){
      const rows = Array.from(itemsList.querySelectorAll('.item-row'));
      let subtotal = 0;
      const breakdown = [];

      rows.forEach(r => {
        const name = r.querySelector('.item-name').value.trim() || 'Item';
        const qty  = parseFloat(r.querySelector('.item-qty').value) || 0;
        const price= parseFloat(r.querySelector('.item-price').value) || 0;
        const line = qty * price;
        subtotal += line;
        breakdown.push({name, qty, price, line});
      });

      const taxRate = parseFloat(taxRateEl.value) || 0;
      const discount = parseFloat(discountEl.value) || 0;

      const taxAmount = (subtotal * taxRate) / 100;
      let grand = subtotal + taxAmount - discount;
      if (!isFinite(grand)) grand = 0;

      subtotalEl.textContent = fmt(subtotal);
      taxAmountEl.textContent = fmt(taxAmount);
      grandTotalEl.textContent = fmt(grand < 0 ? 0 : grand);

      // return structured data if needed elsewhere
      return {subtotal, taxAmount, discount, grand: Math.max(0, grand), breakdown};
    }

    // Clear all items
    clearBtn.addEventListener('click', e => {
      itemsList.innerHTML = '';
      calculate();
    });

    // Reset everything including tax & discount
    resetBtn.addEventListener('click', e => {
      itemsList.innerHTML = '';
      taxRateEl.value = 0;
      discountEl.value = 0;
      // add a blank item to start
      addItem({name:'', qty:1, price:0});
    });

    // Export CSV (simple)
    exportCsvBtn.addEventListener('click', e => {
      const data = calculate();
      const rows = [
        ['Name','Quantity','Unit Price','Line total'],
        ...data.breakdown.map(r => [r.name, r.qty, fmt(r.price), fmt(r.line)]),
        [],
        ['Subtotal', '', '', fmt(data.subtotal)],
        ['Tax (%)', '', '', (parseFloat(taxRateEl.value)||0).toString()],
        ['Tax amount', '', '', fmt(data.taxAmount)],
        ['Discount (fixed)', '', '', fmt(parseFloat(discountEl.value)||0)],
        ['Grand total', '', '', fmt(data.grand)]
      ];

      const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
      // create download link
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'totals.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // Add item button
    addItemBtn.addEventListener('click', () => addItem({name:'', qty:1, price:0}));

    // recalc when tax/discount changed
    [taxRateEl, discountEl].forEach(el => el.addEventListener('input', calculate));

    // initialize with two example rows
    addItem({name:'Example item A', qty:2, price:150});
    addItem({name:'Example item B', qty:1.5, price:75.5});
    // initial calc
    calculate();

    // keyboard: Enter on last input adds a new item for quick entry
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Enter') {
        const active = document.activeElement;
        if (active && (active.classList && (active.classList.contains('item-price') || active.classList.contains('item-qty') || active.classList.contains('item-name')))) {
          // if focused element is inside last row, add a new row
          const rows = itemsList.querySelectorAll('.item-row');
          if (rows.length && rows[rows.length-1].contains(active)) {
            ev.preventDefault();
            addItem({name:'', qty:1, price:0});
          }
        }
      }
    });
  </script>
</body>
</html>
